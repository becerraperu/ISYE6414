---
title: "HW5"
author: "Chong Zhang"
date: "November 26, 2018"
output: html_document
---

```{r cache=TRUE}
library(dplyr)
library(ggplot2)
library(glmnet)
library(MASS)
library(corrplot)


load(file = 'AmesHousing.RData')
attach(house)
scatterplotMatrix(~SalePrice+MS.Zoning+Lot.Area+Lot.Shape+Land.Contour,data = house, smooth=FALSE)
scatterplotMatrix(~SalePrice+Neighborhood+Condition.1+Bldg.Type+House.Style,data = house, smooth=FALSE)
scatterplotMatrix(~SalePrice+Overall.Qual+Overall.Cond+Year.Built+Year.Remod.Add, smooth=FALSE)
scatterplotMatrix(~SalePrice+Roof.Style++Mas.Vnr.Type+Mas.Vnr.Area+Exter.Qual,data = house, smooth=FALSE)
scatterplotMatrix(~SalePrice+Exter.Cond+Foundation+Bsmt.Qual+Bsmt.Cond,data = house, smooth=FALSE)
scatterplotMatrix(~SalePrice+BsmtFin.SF+Total.Bsmt.SF+Heating.QC+Central.Air, data = house, smooth=FALSE)
scatterplotMatrix(~SalePrice+X1st.Flr.SF+Gr.Liv.Area+Bedroom.AbvGr+Kitchen.Qual,data = house, smooth=FALSE)
scatterplotMatrix(~SalePrice+TotRms.AbvGrd+Fireplaces+Fireplace.Qu+Garage.Type,data = house, smooth=FALSE)
scatterplotMatrix(~SalePrice+Garage.Finish+Garage.Cars+Garage.Area+Paved.Drive,data = house, smooth=FALSE)
scatterplotMatrix(~SalePrice+Wood.Deck.SF+Open.Porch.SF+Enclosed.Porch+X3Ssn.Porch,data = house, smooth=FALSE)
scatterplotMatrix(~SalePrice+Screen.Porch+Pool.Area+Fence+Sale.Type,data = house, smooth=FALSE)
scatterplotMatrix(~SalePrice+Sale.Condition+Yr.Sold+Bath,data = house, smooth=FALSE)

```

The distribution of SalePrice is hightly skewed. There are couple of predicting variables shows high level of linearality with SalePrice. Some do not show significant level of linearity. 

(b)

```{r cache=TRUE}
X = model.matrix(lm(house$SalePrice~., data = house))[,-1]
X = cbind(house$SalePrice, X)
corrplot(cor(X), tl.cex = 0.1)
```

There are 18 predictors that correlate strongly with SalePrice.
Yes, there is evidence showing multicollinearity based on the graph. For example, Garage.Cars tend to corrlated strongly with Garage.Area. Because the larger the size of the garage, the more cars you can put in the garage.

Question 2:
```{r cache=TRUE}
model = lm(SalePrice~., data = house)
plot(house$Lot.Area,model$residuals)
abline(h=0,col='red')
plot(house$SalePrice, model$residuals)
abline(h=0,col='red')
plot(house$Year.Built, model$residuals)
abline(h=0,col='red')
plot(house$Mas.Vnr.Area, model$residuals)
abline(h=0,col='red')
plot(house$Garage.Area, model$residuals)
abline(h=0,col='red')
plot(house$Open.Porch.SF, model$residuals)
abline(h=0,col='red')
plot(fitted(model), model$residuals)
abline(h=0,col='red')
```

I have plotted couple of predicting variables against the residules of the model. It seems that overall, the variance is constant for different values of the predicting variables.
However when I plot SalePrice against the residuels, I found that there was a departure at the right tail of the graph.

(b)
```{r cache=TRUE}
bc = boxcox(model)
best.lam = bc$x[which(bc$y==max(bc$y))]
```

best lambda is 0.141414141

(c)
```{r cache=TRUE}
model_log = lm(log(SalePrice)~., data = house)
plot(x=fitted(model_log),y=residuals(model_log))
abline(h=0, col='red')


```

Yes, it seems there is at least 3 outliers.

(d)
```{r cache=TRUE}
cook = cooks.distance(model_log)
cook = as.data.frame(cbind(index=1:length(SalePrice), cooksd = cook))
p = ggplot(data = cook,aes(x=index, y = cooksd)) + geom_point(col='red')+xlab('Index')+ylab('Cook\'s distance')+theme(axis.title = element_text(size=12))
p = p + geom_hline(yintercept = 1, col='blue')
p = p + geom_text(aes(label = ifelse(cooksd>1, index,'')),hjust=-0.1, vjust=0.01)
p

```

After compute the cook's distance, I found that there is no points whose cook's distance is larger than 1. So no observation was removed.

(e)
```{r cache=TRUE}
qqnorm(model_log$residuals)
qqline(model_log$residuals)

```


